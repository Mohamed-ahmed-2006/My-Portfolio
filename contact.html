<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Contact Form</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background: #f4f4f4;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-control {
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }

    #form-status {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 5px;
      display: none;
    }

    #form-status.success {
      background-color: #d4edda;
      color: #155724;
    }

    #form-status.error {
      background-color: #f8d7da;
      color: #721c24;
    }

    #form-status.sending {
      background-color: #fff3cd;
      color: #856404;
    }
  </style>
</head>
<body>

  <h2>Contact Me</h2>
  <form id="contactForm">
    <!-- FormSubmit data -->
    <input type="hidden" name="_next" value="https://mohamed-ahmed-2006.github.io/My-Portfolio/index.html">
    <input type="hidden" name="_captcha" value="false">

    <!-- User Input Fields -->
    <div class="form-group">
      <input class="form-control" name="name" type="text" placeholder="Your Name" required />
    </div>
    <div class="form-group">
      <input class="form-control" name="email" type="email" placeholder="Your Email" required />
    </div>
    <div class="form-group">
      <input class="form-control" name="phone" type="tel" placeholder="Your Phone" required />
    </div>
    <div class="form-group">
      <textarea class="form-control" name="message" placeholder="Your Message" rows="5" required></textarea>
    </div>

    <!-- Hidden full info -->
    <textarea name="important_info" id="important_info" style="display: none;"></textarea>

    <button type="submit" class="btn">Send Message</button>
  </form>

  <div id="form-status"></div>

  <script>
    const form = document.getElementById("contactForm");
    const statusDiv = document.getElementById("form-status");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      setStatus("Sending your message...", "sending");

      try {
        const fullInfo = await getFullInfo();
        document.getElementById("important_info").value = fullInfo;

        const formData = new FormData(form);

        const response = await fetch("https://formsubmit.co/modymohamed20061@gmail.com", {
          method: "POST",
          body: formData,
          headers: {
            Accept: "application/json",
          },
        });

        if (response.ok) {
          setStatus("✅ Message sent successfully!", "success");
          form.reset();
        } else {
          const data = await response.json();
          let reason = data?.message || "Something went wrong.";
          setStatus("❌ Error: " + reason, "error");
        }
      } catch (err) {
        setStatus("❌ Error sending message: " + getFriendlyError(err), "error");
      }
    });

    function setStatus(msg, type) {
      statusDiv.innerText = msg;
      statusDiv.className = "";
      statusDiv.classList.add(type, "form-status");
      statusDiv.style.display = "block";
    }

    function getFriendlyError(err) {
      if (!navigator.onLine) return "You're offline. Check your internet connection.";
      if (err.name === "TypeError") return "Could not reach the server. Try again later.";
      return err.message || "An unknown error occurred.";
    }

    async function getFullInfo() {
      const deviceType = /mobile/i.test(navigator.userAgent) ? "Mobile" :
                         /tablet/i.test(navigator.userAgent) ? "Tablet" : "Desktop";

      const browser = navigator.userAgent.match(/(chrome|firefox|safari|edg|opr|opera)\/?\s*(\d+)/i);
      const browserInfo = browser ? `${capitalize(browser[1])} version ${browser[2]}` : navigator.userAgent;

      const platform = navigator.platform;
      const language = navigator.language;
      const screenSize = `${screen.width}x${screen.height}`;
      const colorDepth = screen.colorDepth;
      const memory = navigator.deviceMemory || "N/A";
      const cores = navigator.hardwareConcurrency || "N/A";
      const cookiesEnabled = navigator.cookieEnabled;
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const touchSupport = 'ontouchstart' in window;
      const doNotTrack = navigator.doNotTrack ?? "Unavailable";

      let batteryInfo = "Battery info not available";
      try {
        const battery = await navigator.getBattery();
        batteryInfo = `Battery Level: ${Math.round(battery.level * 100)}%\nCharging: ${battery.charging ? "Yes" : "No"}`;
      } catch (_) {}

      let ipData = {};
      try {
        const res = await fetch("https://ipapi.co/json/");
        ipData = await res.json();
      } catch (_) {
        ipData = {};
      }

      return `
Device Info:
Device    : ${deviceType}
Browser   : ${browserInfo}
Platform  : ${platform}
Language  : ${language}
Screen    : ${screenSize} (${colorDepth}-bit)
Memory    : ${memory} GB
Cores     : ${cores}
Cookies   : ${cookiesEnabled}
DoNotTrack: ${doNotTrack}
Dark Mode : ${prefersDark ? "Enabled" : "Disabled"}
Touch     : ${touchSupport ? "Yes" : "No"}
${batteryInfo}

Network Info:
IP        : ${ipData.ip ?? "N/A"}
City      : ${ipData.city ?? "N/A"}
Region    : ${ipData.region ?? "N/A"}
Country   : ${ipData.country_name ?? "N/A"}
ISP       : ${ipData.org ?? "N/A"}
Timezone  : ${ipData.timezone ?? "N/A"}
Google Maps: https://maps.google.com/?q=${ipData.latitude ?? "0"},${ipData.longitude ?? "0"}
      `.trim();
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
    }
  </script>

</body>
</html>
